<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BANA7046 Module 5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="module5_files/libs/clipboard/clipboard.min.js"></script>
<script src="module5_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="module5_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="module5_files/libs/quarto-html/popper.min.js"></script>
<script src="module5_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="module5_files/libs/quarto-html/anchor.min.js"></script>
<link href="module5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="module5_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="module5_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="module5_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="module5_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">BANA7046 Module 5</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="model-evaluation" class="level1">
<h1>1. Model Evaluation</h1>
<section id="training-set-and-test-set-split" class="level2">
<h2 class="anchored" data-anchor-id="training-set-and-test-set-split">1.1. Training Set and Test Set Split</h2>
<p>Suppose the data is as follows.</p>
<p><img src="image/regresion_data.png" class="img-fluid" width="290"></p>
<p>Is a linear regression model a good choice?</p>
<p><img src="image/regression_linear.png" class="img-fluid" width="293"></p>
<p>Is a quadractice regression a good choice?</p>
<p><img src="image/regression_quadratic.png" class="img-fluid" width="283"></p>
<p>Or should we “join the dots” also know as piecewise linear nonparametric regression?</p>
<p><img src="image/regression_join_dots.png" class="img-fluid" width="278"></p>
<p>One approach to ask “How well is the model going to predict future data drawn from the same distribution?”</p>
<p>We can split the data into training and test sets. Build the model on the training set, evaluate the model on the test set.</p>
<p>For example, we can randomly choose 30% of the data to be in the test set and the remainder is the training set, we fit regression on the training set and estimate the model’s future performance on the test set.</p>
<p>Below is an example of training and test set split.</p>
<p><img src="image/test_set.png" class="img-fluid" width="308"></p>
<p>We build a linear regression on the training set.</p>
<p><img src="image/linear_train.png" class="img-fluid" width="302"></p>
<p>Can predict on the test set and collect the prediction errors.</p>
<p><img src="image/linear_predict.png" class="img-fluid" width="316"></p>
<p>The same procedue can be done on the quadratic regression and “join the dots.”</p>
<p><img src="image/quad_predict.png" class="img-fluid" width="307"></p>
<p><img src="image/join_dots_predict.png" class="img-fluid" width="312"></p>
<p>For this training and test set split method,</p>
<p>The good news: very simple, just choose the model with the best test set performance.</p>
<p>Bad news: waste data. If we don’t have much data, our test set may be lucky or unlucky. In other words, the test set estimation of the performance is unstable.</p>
</section>
<section id="leave-one-out-cross-validation-loocv" class="level2">
<h2 class="anchored" data-anchor-id="leave-one-out-cross-validation-loocv">1.2. Leave One Out Cross Validation (LOOCV)</h2>
<p>For i = 1 to n, do the following:</p>
<p>Temporarily remove the i-th observation (x_i, y_i) from the data.</p>
<p><img src="image/LOOCV_data.png" class="img-fluid" width="284"></p>
<p>Train the model on the remaining n-1 observations and evaluate the model on the i-th observation.</p>
<p><img src="image/LOOCV_pred.png" class="img-fluid" width="293"></p>
<p>Repeat the above procedure for n times for each observation.</p>
<p><img src="image/LOOCV_linear.png" class="img-fluid"></p>
<p>We can collect all the prediction errors and report the mean error.</p>
<p>We repeat the same procedure for quadratic regression and “join the dots.”</p>
<p><img src="image/LOOCV_quad.png" class="img-fluid"></p>
<p><img src="image/LOOCV_join.png" class="img-fluid"></p>
<p>Let’s compare training/test split and leave one out cross validation.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Col1</th>
<th>Downside</th>
<th>Upside</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Train/test split</td>
<td>variance: unreliable estimate of future performance</td>
<td>Cheap and simple</td>
</tr>
<tr class="even">
<td>Leave one out CV</td>
<td>Expensive. May have some weird behavior.</td>
<td>Don’t waste data</td>
</tr>
</tbody>
</table>
<p>Can we get the best of the both methods?</p>
</section>
<section id="k-fold-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="k-fold-cross-validation">1.3. k-Fold Cross Validation</h2>
<p>Randomly break the dataset into k partitions.</p>
<p>In the following example, we have k=3 partitions colored as red, green and blue.</p>
<p><img src="image/kCV.png" class="img-fluid" width="344"></p>
<p>For the red partition: Train on all the points not in the red partition. Find the test-set sum of errors on the red points.</p>
<p><img src="image/kCV_red.png" class="img-fluid" width="343"></p>
<p>We repeat the same procedure for green and blue partitions.</p>
<p><img src="image/kCV_all.png" class="img-fluid" width="382"></p>
<p>We then report the mean prediction error.</p>
<p><img src="image/kCV_quad.png" class="img-fluid" width="339"></p>
<p><img src="image/kCV_join.png" class="img-fluid" width="335"></p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Evaluation Method</th>
<th>Downside</th>
<th>Upside</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Train/test split</td>
<td>variance: unreliable estimate of future performance</td>
<td>Cheap and simple</td>
</tr>
<tr class="even">
<td>Leave one out CV</td>
<td>Expensive. May have some weird behavior.</td>
<td>Don’t waste data</td>
</tr>
<tr class="odd">
<td>10-fold CV</td>
<td>Wastes 10% of the data. 10x more expensive than test set</td>
<td>Only wastes 10%</td>
</tr>
<tr class="even">
<td>3-fold CV</td>
<td>More wasted data</td>
<td>Slightly better than test set.</td>
</tr>
</tbody>
</table>
<p>CV is used for model selection/comparison/evaluation and tuning parameter selection.</p>
</section>
</section>
<section id="evaluation-of-linear-models-and-lasso" class="level1">
<h1>2. Evaluation of Linear Models and LASSO</h1>
<section id="linear-models" class="level2">
<h2 class="anchored" data-anchor-id="linear-models">2.1. Linear Models</h2>
<p>We now use cross validation, cv.glm(), to evaluate different linear models on the Boston housing price data set. We compare the full model with the model with only two covariates, indus and rm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boston) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">=</span> <span class="fu">glm</span>(medv <span class="sc">~</span> ., <span class="at">data =</span> Boston) </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>model_2var <span class="ot">&lt;-</span> <span class="fu">glm</span>(medv <span class="sc">~</span> indus <span class="sc">+</span> rm,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> Boston) </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 fold CV</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_full,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="dv">10</span>)<span class="sc">$</span>delta[<span class="dv">2</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23.53689</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_2var,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="dv">10</span>)<span class="sc">$</span>delta[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 39.84875</code></pre>
</div>
</div>
<p>The reported numbers by default are mean squared error (MSE). In its output, $delta[2] represents the bias corrected cross validation score. We can certainly change to other measure such as mean absolute deviation (MAE).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>MAE_cost <span class="ot">&lt;-</span> <span class="cf">function</span>(y, yhat){ </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(y <span class="sc">-</span> yhat)))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_full, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">cost =</span> MAE_cost, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="dv">10</span>)<span class="sc">$</span>delta[<span class="dv">2</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.370551</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston,         </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_2var,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">cost =</span> MAE_cost,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="dv">10</span>)<span class="sc">$</span>delta[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.277536</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>MSE_cost <span class="ot">&lt;-</span> <span class="cf">function</span>(y, yhat){ </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>((y <span class="sc">-</span> yhat)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_full, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">cost =</span> MSE_cost, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="dv">10</span>)<span class="sc">$</span>delta[<span class="dv">2</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23.9025</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston,         </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_2var,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">cost =</span> MSE_cost,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="dv">10</span>)<span class="sc">$</span>delta[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.19173</code></pre>
</div>
</div>
<p>If we set K to be the sample size, it is essentially LOOCV.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_full,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="fu">nrow</span>(Boston))<span class="sc">$</span>delta[<span class="dv">2</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23.72388</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(<span class="at">data =</span> Boston,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">glmfit =</span> model_2var,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">K =</span> <span class="fu">nrow</span>(Boston))<span class="sc">$</span>delta[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 39.94028</code></pre>
</div>
</div>
</section>
<section id="lasso" class="level2">
<h2 class="anchored" data-anchor-id="lasso">2.2. LASSO</h2>
<p>One of the most important applications of cross validation is to select the tuning parameters. For example, in LASSO, we need to select the tuning parameter <span class="math inline">\(\lambda\)</span> which adjusts the amount of penalty on the coefficient estimate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("glmnet") </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lasso_fit  <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x =</span> <span class="fu">as.matrix</span>(Boston[, <span class="fu">names</span>(Boston)<span class="sc">!=</span><span class="st">'medv'</span>]),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> Boston<span class="sc">$</span>medv,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> <span class="dv">1</span>) </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#use 10-fold cross validation to pick lambda </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>cv_lasso_fit <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="at">x =</span> <span class="fu">as.matrix</span>(Boston[, <span class="fu">names</span>(Boston)<span class="sc">!=</span><span class="st">'medv'</span>]),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> Boston<span class="sc">$</span>medv,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">nfolds =</span> <span class="dv">10</span>) </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_lasso_fit) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="module5_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cv_lasso_fit<span class="sc">$</span>lambda.min </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03373254</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lasso_fit, <span class="at">s =</span> cv_lasso_fit<span class="sc">$</span>lambda.min) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>14 x 1 sparse Matrix of class "dgCMatrix"
             s=0.03373254
(Intercept)  34.045951491
crim         -0.096365803
zn            0.040567190
indus         .          
chas          2.677797325
nox         -16.091776275
rm            3.879698087
age           .          
dis          -1.376623666
rad           0.243459038
tax          -0.009442628
ptratio      -0.926685654
black         0.008972315
lstat        -0.522483752</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>pred_IS <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_fit,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">as.matrix</span>(Boston[, <span class="fu">names</span>(Boston)<span class="sc">!=</span><span class="st">'medv'</span>]),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">s =</span> cv_lasso_fit<span class="sc">$</span>lambda.min)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_IS, Boston<span class="sc">$</span>medv)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="module5_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MSE_cost</span>(pred_IS, Boston<span class="sc">$</span>medv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21.95255</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MAE_cost</span>(pred_IS, Boston<span class="sc">$</span>medv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.253795</code></pre>
</div>
</div>
</section>
</section>
<section id="evaluation-of-logistic-regression" class="level1">
<h1>3. Evaluation of Logistic Regression</h1>
<section id="evaluation-criterion" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-criterion">3.1. Evaluation Criterion</h2>
<p>In the previous section, we focus on linear models where the response variable is numeric. To evaluate the linear models, we compare the predicted response with the actual response and obtain the prediction error, for example, MSE or MAE.</p>
<p>In this section, we focus on logistic regression with a binary response variable, 0 or 1. To predict the response variable using logistic regression, we need a threshold/cutoff value between 0 and 1. This is because the logistic regression provide only the probability of success at a given x.</p>
<p>Therefore, we can predict the response to be 0 if prob &lt; cutoff, and predict it to be 1 if prob &gt;= cutoff. The default cutoff is 0.5.</p>
<p>With the predicted response, we can compare it with the actual response using the confusion matrix below.</p>
<table class="caption-top table">
<caption>Confusion matrix</caption>
<thead>
<tr class="header">
<th>True label</th>
<th>Predicted as 0</th>
<th>Predicted as 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Actual 0, negative</td>
<td>A, true negative</td>
<td>B, false positive</td>
</tr>
<tr class="even">
<td>Actual 1, positive</td>
<td>C, false negative</td>
<td>D, true positive</td>
</tr>
</tbody>
</table>
<p>The misclassification error rate = (B + C)/(A + B + C + D)</p>
<p>True positive fraction (TPF or sensitivity) is the proportion of positives correctly predicted as positive: D/(C+D).</p>
<p>False positive fraction (FPF or 1-specificity), is the proportion of negatives incorrectly predicted as positive: B/(A+B).</p>
<p>Note that the misclassification error rate, TPF, and FPF are all functions of the cutoff value. If we change the cutoff value, the they also changes.</p>
<p>A way to expand on this idea is to get an overall measure of goodness of classification using the receiver operating characteristic (ROC) curve. ROC curve is generated by plotting FPF (1-specificity) against TPF (sensitivity) at different levels of cutoff values.</p>
<p>Here is an example of changing the cutoff value from 0.5 to 0.25.</p>
<p><img src="image/cutoff.png" class="img-fluid"></p>
<p>If we let the cutoff value change from 0 to 1, or 1 to 0, we have the following ROC curve.</p>
<p><img src="image/ROC.png" class="img-fluid" width="359"></p>
<p>Both TPF and FPF vary inversely with the cutoff value.</p>
<p>The higher the cutoff, the harder it is to classify an observation as positive or 1. As the cutoff increases, both the B and D decrease.</p>
<p>The ROC curve shows possible TPF/FPF combinations as the cutoff value varies.</p>
<p>To evaluate the ROC curve, we usually use the area under the curve (AUC). A rule of thumb (industry standard) is that AUC &gt; 0.7 represents acceptable discriminatory power.</p>
<p><img src="image/AUC.png" class="img-fluid" width="373"></p>
<p>Sometimes, we may face a slightly different binary classification problem.</p>
<p>For example, in bankruptcy prediction, fail to predict a bankruptcy is much more serious than predict a false bankruptcy.</p>
<p>Therefore, we introduce the asymmetric misclassification error rate (AMR) with a revised cutoff value pcut = 1/(1 + r)</p>
<p>AMR = (B + C*r)/(A + B + C + D)</p>
<table class="caption-top table">
<caption>Confusion matrix</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 32%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>True label</th>
<th>Predicted as 0</th>
<th>Predicted as 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Actual 0, negative</td>
<td>A</td>
<td>B</td>
</tr>
<tr class="even">
<td>Actual 1, positive</td>
<td>C, this is the case of Lehman Brothers</td>
<td>D, true positive</td>
</tr>
</tbody>
</table>
</section>
<section id="training-set-and-test-set-split-1" class="level2">
<h2 class="anchored" data-anchor-id="training-set-and-test-set-split-1">3.2. Training Set and Test Set Split</h2>
<p>We use the credit data to illustrate the evaluation of logistic regression. We first split the data into training and test sets, and train the model on the training set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.6
✔ forcats   1.0.1     ✔ stringr   1.5.2
✔ ggplot2   4.0.1     ✔ tibble    3.3.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.2
✔ purrr     1.2.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ tidyr::expand() masks Matrix::expand()
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
✖ tidyr::pack()   masks Matrix::pack()
✖ dplyr::select() masks MASS::select()
✖ tidyr::unpack() masks Matrix::unpack()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>credit <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/credit_default.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 30000 Columns: 24
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (24): LIMIT_BAL, SEX, EDUCATION, MARRIAGE, AGE, PAY_0, PAY_2, PAY_3, PAY...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>credit<span class="sc">$</span>SEX <span class="ot">=</span> <span class="fu">as.factor</span>(credit<span class="sc">$</span>SEX)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>credit<span class="sc">$</span>EDUCATION <span class="ot">=</span> <span class="fu">as.factor</span>(credit<span class="sc">$</span>EDUCATION)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>credit<span class="sc">$</span>MARRIAGE <span class="ot">=</span> <span class="fu">as.factor</span>(credit<span class="sc">$</span>MARRIAGE)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(credit),<span class="fu">nrow</span>(credit)<span class="sc">*</span><span class="fl">0.80</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>credit_train <span class="ot">=</span> credit[index,]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>credit_test <span class="ot">=</span> credit[<span class="sc">-</span>index,]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>credit_glm_train <span class="ot">=</span> <span class="fu">glm</span>(default <span class="sc">~</span> ., </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">family=</span>binomial, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data=</span>credit_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(credit_glm_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = default ~ ., family = binomial, data = credit_train)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -9.929e-01  9.650e-02 -10.290  &lt; 2e-16 ***
LIMIT_BAL   -6.725e-07  1.766e-07  -3.807 0.000140 ***
SEX2        -1.399e-01  3.433e-02  -4.074 4.62e-05 ***
EDUCATION2  -7.472e-02  3.980e-02  -1.878 0.060431 .  
EDUCATION3  -9.073e-02  5.322e-02  -1.705 0.088227 .  
EDUCATION4  -1.093e+00  2.092e-01  -5.224 1.75e-07 ***
MARRIAGE2   -1.867e-01  3.863e-02  -4.834 1.34e-06 ***
MARRIAGE3   -2.328e-01  1.477e-01  -1.576 0.114949    
AGE          5.762e-03  2.073e-03   2.779 0.005456 ** 
PAY_0        5.941e-01  1.982e-02  29.976  &lt; 2e-16 ***
PAY_2        7.969e-02  2.247e-02   3.546 0.000392 ***
PAY_3        7.236e-02  2.529e-02   2.861 0.004222 ** 
PAY_4        1.013e-02  2.802e-02   0.362 0.717640    
PAY_5        4.412e-02  2.991e-02   1.475 0.140206    
PAY_6        7.931e-03  2.478e-02   0.320 0.748891    
BILL_AMT1   -4.813e-06  1.257e-06  -3.828 0.000129 ***
BILL_AMT2    1.805e-06  1.671e-06   1.080 0.279969    
BILL_AMT3    1.156e-06  1.473e-06   0.785 0.432549    
BILL_AMT4    4.364e-07  1.489e-06   0.293 0.769388    
BILL_AMT5    1.023e-06  1.639e-06   0.624 0.532326    
BILL_AMT6   -6.292e-07  1.297e-06  -0.485 0.627498    
PAY_AMT1    -1.365e-05  2.604e-06  -5.240 1.60e-07 ***
PAY_AMT2    -1.153e-05  2.494e-06  -4.624 3.77e-06 ***
PAY_AMT3    -1.865e-06  1.773e-06  -1.051 0.293112    
PAY_AMT4    -3.385e-06  1.934e-06  -1.750 0.080080 .  
PAY_AMT5    -2.398e-06  1.916e-06  -1.252 0.210681    
PAY_AMT6    -3.136e-06  1.522e-06  -2.061 0.039298 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 25425  on 23999  degrees of freedom
Residual deviance: 22252  on 23973  degrees of freedom
AIC: 22306

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>We evaluate the model on the training set. This is only for practice. This is not the correct way to evaluate the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>prob_train <span class="ot">=</span> <span class="fu">predict</span>(credit_glm_train, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(credit_train<span class="sc">$</span>default, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>      (prob_train <span class="sc">&gt;</span> <span class="fl">0.9</span>)<span class="sc">*</span><span class="dv">1</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"Truth"</span>,<span class="st">"Predicted"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Predicted
Truth     0     1
    0 18648    19
    1  5302    31</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(credit_train<span class="sc">$</span>default, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>      (prob_train <span class="sc">&gt;</span> <span class="fl">0.5</span>)<span class="sc">*</span><span class="dv">1</span>, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"Truth"</span>,<span class="st">"Predicted"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Predicted
Truth     0     1
    0 18130   537
    1  4017  1316</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(credit_train<span class="sc">$</span>default, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>      (prob_train <span class="sc">&gt;</span> <span class="fl">0.2</span>)<span class="sc">*</span><span class="dv">1</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"Truth"</span>,<span class="st">"Predicted"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Predicted
Truth     0     1
    0 11009  7658
    1  1562  3771</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(credit_train<span class="sc">$</span>default, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>      (prob_train <span class="sc">&gt;</span> <span class="fl">0.0001</span>)<span class="sc">*</span><span class="dv">1</span>, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">dnn =</span> <span class="fu">c</span>(<span class="st">"Truth"</span>,<span class="st">"Predicted"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Predicted
Truth     0     1
    0     5 18662
    1     0  5333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cost1 <span class="ot">&lt;-</span> <span class="cf">function</span>(r, pi, <span class="at">pcut =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>){</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(((r<span class="sc">==</span><span class="dv">0</span>)<span class="sc">&amp;</span>(pi<span class="sc">&gt;</span>pcut)) <span class="sc">|</span> ((r<span class="sc">==</span><span class="dv">1</span>)<span class="sc">&amp;</span>(pi<span class="sc">&lt;</span>pcut)))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>cost2 <span class="ot">&lt;-</span> <span class="cf">function</span>(r, pi, <span class="at">pcut=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>){</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  weight1 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  weight0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  c1 <span class="ot">&lt;-</span> (r<span class="sc">==</span><span class="dv">1</span>)<span class="sc">&amp;</span>(pi<span class="sc">&lt;</span>pcut) </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#logical vector - true if actual 1 but predict 0</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  c0 <span class="ot">&lt;-</span>(r<span class="sc">==</span><span class="dv">0</span>)<span class="sc">&amp;</span>(pi<span class="sc">&gt;</span>pcut) </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#logical vector - true if actual 0 but predict 1</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(weight1<span class="sc">*</span>c1<span class="sc">+</span>weight0<span class="sc">*</span>c0))</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cost1</span>(<span class="at">r =</span> credit_train<span class="sc">$</span>default, <span class="at">pi =</span> prob_train, <span class="at">pcut=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.18975</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cost2</span>(<span class="at">r =</span> credit_train<span class="sc">$</span>default, <span class="at">pi =</span> prob_train, <span class="at">pcut=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6809583</code></pre>
</div>
</div>
<p>We construct the ROC curve on the training set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>prob_train <span class="ot">=</span> <span class="fu">predict</span>(credit_glm_train, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('ROCR')</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(prob_train,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                   credit_train<span class="sc">$</span>default)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">colorize=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="module5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">slot</span>(<span class="fu">performance</span>(pred, <span class="st">"auc"</span>), <span class="st">"y.values"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7278298</code></pre>
</div>
</div>
<p>Finally, we evaluate it on the test set using ROC and AUC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>prob_test<span class="ot">&lt;-</span> <span class="fu">predict</span>(credit_glm_train, </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> credit_test, </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(prob_test, credit_test<span class="sc">$</span>default)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">colorize=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="module5_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">slot</span>(<span class="fu">performance</span>(pred, <span class="st">"auc"</span>), <span class="st">"y.values"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.717574</code></pre>
</div>
</div>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">3.3. Cross Validation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>pcut <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Symmetric cost, equivalently pcut=1/2</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>cost1 <span class="ot">&lt;-</span> <span class="cf">function</span>(r, pi, <span class="at">pcut=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>){</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(((r<span class="sc">==</span><span class="dv">0</span>)<span class="sc">&amp;</span>(pi<span class="sc">&gt;</span>pcut)) <span class="sc">|</span> ((r<span class="sc">==</span><span class="dv">1</span>)<span class="sc">&amp;</span>(pi<span class="sc">&lt;</span>pcut)))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Asymmetric cost, pcut=1/(5+1) for 5:1 ratio</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>costfunc  <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, pred.p){</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the weight for "true=1 but pred=0" (FN)</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  weight1 <span class="ot">&lt;-</span> <span class="dv">5</span>   </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the weight for "true=0 but pred=1" (FP)</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  weight0 <span class="ot">&lt;-</span> <span class="dv">1</span>    </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  pcut <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>weight1<span class="sc">/</span>weight0)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># logical vector for "true=1 but pred=0" (FN)</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  c1 <span class="ot">&lt;-</span> (obs<span class="sc">==</span><span class="dv">1</span>)<span class="sc">&amp;</span>(pred.p <span class="sc">&lt;</span> pcut)    </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#logical vector for "true=0 but pred=1" (FP)</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  c0 <span class="ot">&lt;-</span> (obs<span class="sc">==</span><span class="dv">0</span>)<span class="sc">&amp;</span>(pred.p <span class="sc">&gt;=</span> pcut)   </span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># misclassification with weight</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  cost <span class="ot">&lt;-</span> <span class="fu">mean</span>(weight1<span class="sc">*</span>c1 <span class="sc">+</span> weight0<span class="sc">*</span>c0)  </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># you have to return to a value when you write R functions</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cost) </span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>} <span class="co"># end </span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a><span class="co">#AUC as cost</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>costfunc1 <span class="ot">=</span> <span class="cf">function</span>(obs, pred.p){</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(pred.p, obs)</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  cost <span class="ot">=</span><span class="fu">unlist</span>(<span class="fu">slot</span>(<span class="fu">performance</span>(pred, <span class="st">"auc"</span>), </span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"y.values"</span>))</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cost)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>credit_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(default<span class="sc">~</span>. , </span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> binomial, </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> credit);  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>cv_result  <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(<span class="at">data =</span> credit, </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">glmfit =</span> credit_glm, </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cost =</span> costfunc, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">K=</span><span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#asymmetric misclassification rate 5:1 as cost </span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>cv_result<span class="sc">$</span>delta[<span class="dv">2</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.68473</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>cv_result1  <span class="ot">&lt;-</span> <span class="fu">cv.glm</span>(<span class="at">data =</span> credit, </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">glmfit =</span> credit_glm, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cost =</span> costfunc1, </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">K=</span><span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>cv_result1<span class="sc">$</span>delta[<span class="dv">2</span>] <span class="co">#AUC as cost</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7242189</code></pre>
</div>
</div>
<p>To evaluate the generalized linear model, we use the R function cv.glm(). This function conducts the K-fold cross-validation for the generalized linear models and obtain its prediction error.</p>
<p>The syntax is</p>
<p>cv.glm(data, glmfit, cost, K)</p>
<p>Here, data: the full data</p>
<p>glmfit: the generalized linear model we build</p>
<p>cost: it is by default tne mean squared error (MSE) for regression. We need to adjust it for classification, e.g.&nbsp;((asymmetric) misclassification rate, AUC)</p>
<p>K: the number of folds in cross validation. It is by default n, i.e., the sample size. Typically we use K=2, … ,10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>cost_lm <span class="ot">=</span> <span class="cf">function</span>(y, yhat){</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y is a vector of response</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yhat is a vector of predicted response.</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>((y<span class="sc">-</span>yhat)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>credit <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/credit_default.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 30000 Columns: 24
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (24): LIMIT_BAL, SEX, EDUCATION, MARRIAGE, AGE, PAY_0, PAY_2, PAY_3, PAY...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>credit_glm <span class="ot">=</span> <span class="fu">glm</span>(default <span class="sc">~</span> .,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> binomial, </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> credit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv.glm</span>(credit, credit_glm, cost1, <span class="at">K =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$call
cv.glm(data = credit, glmfit = credit_glm, cost = cost1, K = 10)

$K
[1] 10

$delta
[1] 0.1889667 0.1888667

$seed
  [1]       10403         119 -1497659119 -1907567746  -309628768 -1607046016
  [7]  1934713708  1094868808   200497945 -2020662419   773912346  1546182931
 [13]   275258235  2043938394 -1700090502  -567716057   885331996  -513902579
 [19]  -789696225 -1172103572  2044244285 -1343338151 -2011974632   917530680
 [25]  -597014796   437300560  1776169624 -1961803802 -1016026046   998921823
 [31]   805059170   522088832  1463152096     3227512 -1747626402 -1233263776
 [37]  1860288804 -1793197120   -42423694  -394349824  1731067480 -2054508277
 [43] -1132314749   560311788  -401684176  1883487245 -1571695456  -270693879
 [49]   -52430361 -1525843947  1110995381  -570569023 -1004801277  -429832132
 [55]   181436557 -1424889565   625025090 -1519988645  1579756798 -1560389152
 [61]   -13381453 -1370565831   120883462   932150811 -1847577285  1592153365
 [67]  1036578443   548158310  -403684164   568780077  -818077494 -1577427264
 [73]  1582594212  -973145600  -903640844  -815567031 -2050689441   872382846
 [79]  -925860568 -1966341289   -89584885   107490046  1873843978  -585332177
 [85] -1429426287  1958990803  -921753934  1267959130  1903575746    97429560
 [91] -1973620758  -290944108 -1145860843  1115629836   786627817  1554695787
 [97]  1372473098   789214486 -1013714984  1383622280  -418858627   409808950
[103]  -227950721  -716231446  -336770150  1631958963  -257516758  -445064083
[109]   318054000   248439325 -1930114011  1450572217  -905109197  -817886251
[115] -1299826241  -825312108  -244314466 -2115527973 -1527842028   281848178
[121]   -69318491 -1063665620   437153537  1466336130   857205096  1791397891
[127]   -89166244   424633025  1413358350  1322680657 -1683017787   750213713
[133]  1791993513 -1701914707  -610425382 -1221264917 -1932068740  1952120000
[139]  -989687276  -706047966  2143638623  -761976749  1113016008   349785511
[145] -1541687564  -312619984  1923626012 -1901707467  1053443833 -2102190973
[151]  -479165003 -1796764781  1323828116  -721281138   399685945   801755769
[157]   859043754  1918201714 -2042111584  -842088620  1410555709  1593901713
[163]  1035220122   -53331966   271888010  -198105869 -1111751147  -234250275
[169]  -676215643   293752010  1537209298  1327740569  -617444133 -1256990890
[175]  1247006211  -739109983 -1324985754   970697138 -1071338404  1061177692
[181]   853732100   636898520  -640534925  -220821964 -1950280987   316297257
[187] -1857726311 -2079992334   833940123   474720252 -1502865451  1366212353
[193]    77150527  1893442038 -1093646406  1531197171   934363089   895989262
[199]  -475853673  1898114821 -1502561817    52378962  -612436495  2103067463
[205]  1590406840   227960702  -516678077    19254631 -1484846902   228437880
[211]  1132082245 -2059357325 -1237750935  1085731935   -22682490  1239071128
[217]  1393099251  -498748359   652471364   102969003  2111673348  -656179637
[223]   246747965 -1681075178   663435201  1142642113  -204364516 -1048439036
[229]  -192310491  -906521860   706690432 -1154920676     7367138  1561144537
[235]  -760980506   970594435  -984173301  1028413043  1786751882  -545054749
[241] -1092356553   519427582   -96272654 -2129907137  1775862053  1935327980
[247] -1165110112  -313630519  -464787425  2016439525  -115196735  1056270408
[253]  -435672427  1452708515   482240326  1794351225  -384503152  1477189072
[259]   766354435 -1927091536 -1403374710  1411209486   760423353   280921942
[265]  -588296819    26081607  -823323553   639954054  1703852801 -1641563498
[271]   809797091  1410500439   864292594   675096115 -2103617322 -1069525098
[277]  1676836899 -1669452585  2111552527  -542353270 -1310885926 -1813210798
[283] -1105354116   593189757  -201841589  -977656699  1027596917   726031217
[289]    14518389   -71691180 -1925532350  -953469975  2023785875  -584012987
[295]  2101699531  1453571860  1446032306   922333212  -286422693  1999122605
[301]  -261791290  -620878944 -1247924782  1301174913  1129695584  -397935559
[307]   972931928  -363742306 -1752105286  -246476887   192074269   267687101
[313]  1096678997   860534506 -1905575496  -402047833  -259925606   577713605
[319]  -456345764   995847619  1732051280 -1826522776   734469817 -1868702855
[325] -1210843977  2080696047   796488487 -1627724985  -720694616  1922873614
[331]   281576765   355570372 -2103028347  1146293340  1554394547 -1584598382
[337]  -182912006  1547388519  -247480031   549370883   984967578 -1871684833
[343]   -59254254 -1020052959    96450858   713070514   285149120   719968620
[349] -2033324964  1602031709  -252849284   163010008   405329120   152837175
[355]   651623432   278374198  1568251121  1741889216 -1908489055 -1298979918
[361]   946556363   850471327  1533526282     6556399   119264998 -1206218781
[367]   543208027     2299385 -1779776891  -146277328 -1886699495   895330909
[373]  -663018398  -772945399 -1817116084 -1750126213  -101270157  1306896851
[379]  2125433061 -2144583816 -1135214710  1614731434  -973487341  1744699856
[385]  1540579427   695482564  -921798232   570126262  -153305758 -1336883810
[391]   906842480  1103777092  1326128717  1393200723  1531987681  -504679248
[397] -1015259076 -1772227360  2104505055  -921147135    78960565  1166538171
[403]  -651401854   112504440   541893926  -418591431  -364172292   -12133553
[409] -1998749247  1146025740  -791993437  -762698681 -1214360083 -1088099032
[415] -1088295241  1127864457   394834538  1150799576  -803209051   687449844
[421]   702293755  -809192261  1874817745  -789140917  1836278607  -209355027
[427] -1483151251  2011491335 -1700564244   144129470  -626227028   681711297
[433]  -712970124  1700101854  1933240623  2146233501  -521059773 -1214670444
[439]  1781708433 -1227810674  1264391007   991273180   909911961 -2103285881
[445]  1021318268   513841426  1496814066  -540546225  1110555409  1047214236
[451]  1858239134  1966148423   580325360  -469354616 -1625225880  2071032729
[457]  1936658982  1005683444   125206918 -1194670309   882690191  -839990377
[463]  -834857853   861997584 -1331308832  1237279233  -892796981   949930849
[469]   838809215  1656156622  -605686267  -689238990  1039334585  -232322708
[475]   625024329  1677674463 -1096953550   174522696   869228144 -1043848357
[481] -1970471523    38158122 -1447680057   697524827  -429339653  -627020572
[487] -2031203968  2028335280  -648375298  -116046899  -667585645   280350416
[493]   -46589892  -290841395  -631807336 -1647671872    16472311 -1710836307
[499]   147275986   710699541  -285668661  1797249501  -866815773  -311383918
[505]  1514682401   700950293    77002767   879482524  2008789689  1870020497
[511]   387882760  -195818639    43569484 -1907051828 -1935504419 -1792443807
[517] -2122476682   523196963 -1849420806  -689190488  1200360588  1914246735
[523]   439572830  -330148459  -512450835  -481342310   933411847   137507653
[529]  1509148311  1156008134 -1799520796  1167491013  1256409064 -1935302425
[535] -1308903557 -1568282535   477869894  -374259718   863520769   553281443
[541] -1142983472   626782557  -442283271  1409667737 -2026028421   902826265
[547] -1356388459 -1260163733   391102933  1543666504 -1376385483  -683553716
[553]   756213585   111249647 -1133453510  1487233942 -1118717310   550612639
[559] -1742636575  -943697423 -1631640475   939771196  2139449022 -1132522102
[565]    14612369 -1486008207  -877879021  1409120192   990886866 -1823107336
[571]    -5562243 -2017841244   376046116  -270982955  1531927218  -186754828
[577]  1647152011   235417978   141868970 -1118588059 -1238880799   670699535
[583]  2135376388 -1929671842 -1381151447 -1595645165   832765175  1793683847
[589]  1505195256   514622655  2113999176  1666571323   402245107  1796854195
[595] -1339641858 -1682052537    95221802  -334166570  1178983388 -2024092683
[601]   270812619  1986336459  1026191358  -442973522  -802316723 -2078057594
[607] -1510075280   528183430  1981567633 -1001854095 -1357305146 -2140910800
[613]  -383881108   312888290 -1906763738 -1344974603   868310186  2063138252
[619]   554553536 -1452532577  -513422572   732500088  -483399248 -1399170353
[625]  1527881146  -148552056</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>pcut <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>cost_glm <span class="ot">=</span> <span class="cf">function</span>(y, pi){</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># symmetric misclassification</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>( ((r<span class="sc">==</span><span class="dv">0</span>)<span class="sc">&amp;</span>(pi<span class="sc">&gt;</span>pcut))<span class="sc">|</span>((r<span class="sc">==</span><span class="dv">1</span>)<span class="sc">&amp;</span>(pi<span class="sc">&lt;</span>pcut)) )</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How to use cv.glm()?</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>